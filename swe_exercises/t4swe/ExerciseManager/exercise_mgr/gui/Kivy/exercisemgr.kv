#:kivy 1.0

<RetractFilter>:
    size_hint: None,1
    width: 20
    retracted: 0
    btn: btn
    Button:
        id: btn
        text: '<-'
        height: 10
        on_press: root.retracted = not root.retracted; root.label_change(root.retracted); root.parent.filter.retract()

<RetractExit>:
    size_hint: None,1
    width: 20
    retracted: 0
    btn: btn
    Button:
        id: btn
        text: '->'
        height: 10
        on_press: root.retracted = not root.retracted; root.label_change(root.retracted); root.parent.exit.retract()





<FilterController>:
    cols: 1
    visible: True
    size_hint_x: 1 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible



<OneArrangementItem>:
    size_hint_y: None
    orientation: 'horizontal'
    Label:
        text: root.exercise_name
        height: 40
        size_hint_y: None
    Button:
        text: 'up'
        height: 40
        size_hint_y: None
        on_release: root.on_up_button()
    Button:
        text: 'down'
        height: 40
        size_hint_y: None
        on_release: root.on_down_button()
    Button:
        text: 'remove'
        height: 40
        size_hint_y: None
        on_release: root.on_remove_button()

<ExitLayout>:
    cols: 1
    visible: True
    size_hint_x: 1 if self.visible else 0
    opacity: 1 if self.visible else 0
    disabled: not self.visible
    Button:
        text: 'create pdf'
        height: 40
        size_hint_y: None
        on_release: root.on_create_pdf()
    Button:
        text: 'preview all'
        height: 40
        size_hint_y: None
        on_press: root.on_preview_all()
    Button:
        text: 'edit header'
        height: 40
        size_hint_y: None
        on_press: root.on_edit_header()

<OneScrollItem>:
    height: self.minimum_height
    size_hint_y: None
    orientation: 'vertical'
    expanded: False
    BoxLayout:
        orientation: 'horizontal'
        height: 30
        size_hint_y: None
        Button:
            text: root.exercises_of_family[root.family_index_displayed].get_exercise_name()
            height: 30
            size_hint_y: None
            on_press: root.expanded = not root.expanded
        Button:
            text: '<-'
            height: 30
            size_hint_y: None
            on_press: root.on_previous_button()
        Button:
            text: '->'
            height: 30
            size_hint_y: None
            on_press: root.on_next_button()
        Button:
            text: 'remove'
            height: 30
            size_hint_y: None
            on_release: root.on_remove_button()
        Button:
            text: 'to problem set'
            height: 30
            size_hint_y: None
            on_release: root.on_add_to_current_problem_set_button()
        Button:
            text: 'overwrite'
            height: 30
            size_hint_y: None
            on_release: root.expanded = True;root.on_overwrite_button()
        Button:
            text: 'save'
            height: 30
            size_hint_y: None
            on_press: root.expanded = True; root.on_save_button()
        Button:
            text: "E"
            height: 30
            size_hint_y: None
            on_press: root.on_edit_popup()
    TextInput:
        font_size: root.font_size
        text: root.exercises_of_family[root.family_index_displayed].get_exercise_content() if root.expanded else root.exercises_of_family[root.family_index_displayed].get_exercise_summary()
        on_focus: root.expanded = True
        height: self.minimum_height
        size_hint_y: None

<ProblemSetPopup>:
    orientation: 'vertical'
    TextInput:
        height: 30
        input_filter: "int"
        id: number_problem_set
        font_size: root.font_size
        height: self.minimum_height
        size_hint_y: None
    Button:
        text: "do not add to database"
        font_size: root.font_size
        height: 30
        size_hint_y: None
        on_press: root.on_not_add_to_database()
    Button:
        text: "add to database"
        font_size: root.font_size
        height: 30
        size_hint_y: None
        on_press: root.on_add_to_database()

<NamePopup>:
    orientation: 'vertical'
    TextInput:
        text: root.exercise_name
        id: name_text
        font_size: root.font_size
        height: self.minimum_height
        size_hint_y: None
    Button:
        height: 30
        text: "save"
        on_press: root.on_save()

<EditPopup>:
    orientation: 'vertical'
    PopupMultiSelectSpinner:
        id: descriptive_spinner
        selected_values: root.start_descriptive_value
        values: root.descriptive_filteroptions
        size_hint: 1, None
        height: 50
        text: "choose descriptive tag"
        background_color: [0.3, 0.5, 0.8, 0.5]
    PopupMultiSelectSpinner:
        id: topic_spinner
        selected_values: root.start_value
        values: root.topics
        size_hint: 1, None
        height: 50
        text: "choose topic"
        background_color: [0.3, 0.5, 0.8, 0.5]
    Button:
        text: "Save"
        height: 50
        on_press: root.on_save()




BoxLayout:
    id: box
    orientation: 'horizontal'
    filter: filter
    exit: exit
    RetractFilter:
        id: retract
    GridLayout:
        pos: 20,0
        cols: 3
        FilterController:
            id: filter
            cols: 1
        ExerciseLayout:
            size_hint: 2,1
            bar_width: 20
            bar_margin: 0
            bar_inactive_color: [.7, .7, .7, .9]
            scroll_type: ['bars']
            smooth_scroll_end: 0
            scroll_wheel_distance: 100
            exit: root.exit
        ExitLayout:
            id: exit
            cols: 1
    RetractExit:
        id: retract_exit


